<%- include('../partials/header.ejs', { title: 'All Students' }) %>

<div class="container">
    <h1>All Students</h1>

    <form action="/students" method="GET" style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center; border: none; background: none;">
        <input type="text" name="search" placeholder="Search by ID or Name" value="<%= search %>" style="width: 300px; margin-bottom: 0;">
        <button type="submit">Search</button>
        <% if (search) { %>
            <a href="/students">Clear Search</a>
        <% } %>
    </form>

    <p><a href="/students/new" class="button">Add New Student</a></p>

    <% if (students.length > 0) { %>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Major</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% students.forEach(student => { %>
                    <tr>
                        <td><%= student.studentId %></td>
                        <td><%= student.name %></td>
                        <td><%= student.major %></td>
                        <td>
                            <a href="/students/<%= student._id %>">View</a> |
                            <a href="/students/<%= student._id %>/edit">Edit</a> |
                            <form action="/students/<%= student._id %>/delete" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete <%= student.name %>?');">
                                <button type="submit">Delete</button>
                            </form>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    <% } else { %>
        <p>No students found. <%= search ? 'Try a different search term.' : 'Start by adding a new student.' %></p>
    <% } %>
</div>

<%- include('../partials/footer.ejs') %>